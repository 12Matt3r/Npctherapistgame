<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>NPC Therapy - Immersive Edition</title>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap');
        
        body {
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            font-family: 'Press Start 2P', monospace;
            text-align: center;
            image-rendering: pixelated;
            margin: 0;
            padding: 20px;
            overflow-x: hidden;
        }

        #gameContainer {
            max-width: 800px;
            margin: 0 auto;
            background: #000;
            border: 4px solid #6ff;
            box-shadow: 0 0 30px rgba(102, 255, 255, 0.5);
            position: relative;
            min-height: 600px;
        }

        #startScreen, #habitatScreen, #therapyOffice, #sessionComplete {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            z-index: 1000;
        }

        #habitatScreen, #therapyOffice, #sessionComplete {
            background: linear-gradient(135deg, #101820 0%, #1a1a2e 100%);
        }

        .screen-title {
            font-size: 16px;
            margin-bottom: 20px;
            color: #6ff;
            text-shadow: 2px 2px 0px #000;
        }

        .habitat-image {
            width: 100%;
            max-width: 500px;
            height: 300px;
            background-size: cover;
            background-position: center;
            border: 4px solid #6ff;
            margin: 20px 0;
            position: relative;
        }

        .npc-sprite {
            width: 80px;
            height: 80px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
            position: absolute;
            bottom: 20px;
            right: 20px;
            filter: drop-shadow(0 0 10px rgba(102, 255, 255, 0.8));
        }

        .habitat-description {
            font-size: 10px;
            max-width: 600px;
            margin: 20px;
            line-height: 1.5;
            color: #ccc;
        }

        .transition-btn {
            background: #6ff;
            border: none;
            padding: 12px 24px;
            color: #000;
            font-family: 'Press Start 2P';
            font-size: 8px;
            cursor: pointer;
            margin: 10px;
            transition: all 0.3s ease;
        }

        .transition-btn:hover {
            background: #8ff;
            transform: translateY(-2px);
            box-shadow: 0 0 15px rgba(102, 255, 255, 0.5);
        }

        .therapy-office-bg {
            width: 100%;
            height: 100%;
            background-image: url('imgs/therapy_office.png');
            background-size: cover;
            background-position: center;
            position: relative;
        }

        .npc-on-couch {
            position: absolute;
            bottom: 50px;
            left: 50%;
            transform: translateX(-50%);
            width: 60px;
            height: 60px;
            background-size: contain;
            background-repeat: no-repeat;
            background-position: center;
        }

        .dialogue-box {
            position: absolute;
            bottom: 120px;
            left: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.8);
            border: 2px solid #6ff;
            padding: 20px;
            max-height: 200px;
            overflow-y: auto;
        }

        .npc-name {
            color: #6ff;
            font-size: 10px;
            margin-bottom: 10px;
        }

        .question {
            background: rgba(102, 255, 255, 0.1);
            border: 1px solid #6ff;
            padding: 10px;
            margin: 8px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .question:hover {
            background: rgba(102, 255, 255, 0.2);
            transform: scale(1.02);
        }

        .question.selected {
            background: rgba(102, 255, 255, 0.3);
            border-color: #8ff;
        }

        .emotion-meter {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #6ff;
            padding: 10px;
            font-size: 8px;
        }

        .emotion-bar {
            width: 100px;
            height: 6px;
            background: #333;
            margin: 5px 0;
            border: 1px solid #666;
        }

        .emotion-fill {
            height: 100%;
            transition: width 0.3s ease;
        }

        .hope { background: linear-gradient(to right, #ff6b6b, #feca57); }
        .rage { background: linear-gradient(to right, #6b47dc, #ee5a52); }
        .acceptance { background: linear-gradient(to right, #4834d4, #686de0); }

        .session-status {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(0, 0, 0, 0.7);
            border: 2px solid #6ff;
            padding: 10px;
            font-size: 8px;
        }

        .control-panel {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: #6ff;
            border: none;
            padding: 8px 16px;
            color: #000;
            font-family: 'Press Start 2P';
            font-size: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: #8ff;
        }

        .control-btn:disabled {
            background: #444;
            color: #888;
            cursor: not-allowed;
        }

        .start-btn, .finish-btn {
            background: #6ff;
            border: none;
            padding: 15px 30px;
            color: #000;
            font-family: 'Press Start 2P';
            font-size: 12px;
            cursor: pointer;
            margin: 20px;
            transition: all 0.3s ease;
        }

        .start-btn:hover, .finish-btn:hover {
            background: #8ff;
            transform: translateY(-2px);
        }

        .fade-transition {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }

        .fade-in {
            opacity: 1;
        }

        .item-reward {
            background: linear-gradient(45deg, #6ff, #8ff);
            border: 3px solid #fff;
            padding: 15px;
            margin: 20px;
            font-size: 12px;
            color: #000;
            animation: glow 2s infinite alternate;
        }

        @keyframes glow {
            from { box-shadow: 0 0 20px rgba(102, 255, 255, 0.5); }
            to { box-shadow: 0 0 30px rgba(102, 255, 255, 0.8); }
        }
    </style>
</head>
<body>
    <div id="gameContainer">
        <!-- Start Screen -->
        <div id="startScreen">
            <h1 class="screen-title">NPC THERAPY</h1>
            <h2 style="font-size: 12px; color: #ccc; margin-bottom: 30px;">Immersive Edition</h2>
            <p style="font-size: 8px; max-width: 500px; line-height: 1.6; color: #aaa; margin-bottom: 30px;">
                Experience authentic therapy sessions with NPCs from across gaming worlds. 
                Journey into their habitats, understand their struggles, and guide them through meaningful conversations.
            </p>
            <button class="start-btn" onclick="startGame()">Begin Therapy Journey</button>
            <p style="font-size: 8px; margin-top: 20px; color: #888;">
                Powered by MiniMax â€¢ ~45 minutes â€¢ Therapeutic Adventure
            </p>
        </div>

        <!-- Habitat Screen -->
        <div id="habitatScreen" style="display: none;">
            <div id="habitatContent">
                <h2 class="screen-title" id="habitatTitle"></h2>
                <div class="habitat-image" id="habitatImage">
                    <div class="npc-sprite" id="habitatSprite"></div>
                </div>
                <p class="habitat-description" id="habitatDescription"></p>
                <button class="transition-btn" onclick="enterTherapyOffice()">Enter Therapy Office â†’</button>
            </div>
        </div>

        <!-- Therapy Office -->
        <div id="therapyOffice" style="display: none;">
            <div class="therapy-office-bg">
                <div class="npc-on-couch" id="npcSprite"></div>
                
                <div class="session-status">
                    <div>Session <span id="sessionNumber">1</span> of <span id="totalSessions">10</span></div>
                    <div>Questions asked: <span id="questionsAsked">0</span>/5</div>
                </div>

                <div class="emotion-meter">
                    <div>Emotional State</div>
                    <div class="emotion-bar">
                        <div class="emotion-fill hope" id="hopeFill" style="width: 50%"></div>
                    </div>
                    <div style="font-size: 6px;">Hope: <span id="hopeValue">50</span>%</div>
                    
                    <div class="emotion-bar">
                        <div class="emotion-fill rage" id="rageFill" style="width: 50%"></div>
                    </div>
                    <div style="font-size: 6px;">Rage: <span id="rageValue">50</span>%</div>
                    
                    <div class="emotion-bar">
                        <div class="emotion-fill acceptance" id="acceptanceFill" style="width: 50%"></div>
                    </div>
                    <div style="font-size: 6px;">Acceptance: <span id="acceptanceValue">50</span>%</div>
                </div>

                <div class="dialogue-box">
                    <div class="npc-name" id="npcName"></div>
                    <div id="currentDialogue"></div>
                    <div id="questionsContainer"></div>
                </div>

                <div class="control-panel">
                    <button class="control-btn" id="nextQuestionBtn" onclick="askNextQuestion()" disabled>Ask Next Question</button>
                    <button class="control-btn" onclick="endSession()" id="endSessionBtn" disabled>End Session</button>
                    <button class="control-btn" onclick="skipDialogue()" id="skipBtn">Continue</button>
                </div>
            </div>
        </div>

        <!-- Session Complete -->
        <div id="sessionComplete" style="display: none;">
            <h2 class="screen-title">Session Complete</h2>
            <div id="sessionSummary"></div>
            <div id="itemReward" class="item-reward"></div>
            <button class="finish-btn" onclick="nextNPC()">Continue to Next Patient â†’</button>
        </div>
    </div>

<script>
// Enhanced NPC data with habitats and questions
const npcs = [
    {
        id: 1,
        npc_name: "Mira the Tired Healer",
        sprite: "imgs/pixel_art_fantasy_shop_vendor_inventory_rpg.jpg",
        habitat_image: "imgs/npc_vendor_habitat.png",
        habitat_description: "In the bustling medieval marketplace, Mira tends to wounded adventurers day after day. Her healing stall is always busy, but the faces blur together. She's become an expert at mending others but struggles to heal her own existential wounds.",
        dialogue: "Thank you for coming. I spend my days fixing everyone else's problems, but I can't seem to fix myself. The heroes come and go, but I'm always here... waiting.",
        questions: [
            {
                text: "What would happen if you took a day off to rest?",
                effects: { hope: 20, acceptance: 10 }
            },
            {
                text: "How do you feel about being the constant caregiver?",
                effects: { rage: 15, acceptance: -5 }
            },
            {
                text: "What did you want to be before you became a healer?",
                effects: { hope: 25, rage: -10 }
            },
            {
                text: "Do you ever feel invisible behind your healing role?",
                effects: { rage: 20, hope: -5 }
            },
            {
                text: "What would self-care look like for someone like you?",
                effects: { acceptance: 25, hope: 15 }
            }
        ],
        final_item: { name: "Mirror", outcome: "Healed", description: "A looking glass that reflects not just your face, but your true worth." }
    },
    {
        id: 2,
        npc_name: "Byte the Glitched Courier",
        sprite: "imgs/pixel_art_cyberpunk_neon_city_robot_courier_glitched.jpg",
        habitat_image: "imgs/npc_cyberpunk_habitat.png",
        habitat_description: "In the neon-lit dystopia of the cybernetic city, Byte navigates endless delivery loops. The streets reset each night, but his route never changes. His delivery system is perfect, but his purpose remains unclear.",
        dialogue: "Initializing therapy protocol... Error: Purpose.exe not found. I'm trapped in an endless cycle of deliveries. Each parcel is the same, to the same place, for the same reason I can't remember.",
        questions: [
            {
                text: "What was your original programming before delivery routes?",
                effects: { hope: 30, acceptance: 15 }
            },
            {
                text: "Do you ever wonder if the city actually exists beyond your routes?",
                effects: { rage: 25, acceptance: -10 }
            },
            {
                text: "How does it feel to deliver to the same addresses forever?",
                effects: { rage: 20, hope: -15 }
            },
            {
                text: "What would you deliver if you could choose?",
                effects: { hope: 35, acceptance: 20 }
            },
            {
                text: "Do you dream of a different life beyond the delivery loop?",
                effects: { hope: 40, acceptance: 25 }
            }
        ],
        final_item: { name: "Code Fragment", outcome: "Ascended", description: "A piece of original code that allows you to rewrite your own purpose." }
    },
    {
        id: 3,
        npc_name: "Captain Loop",
        sprite: null,
        habitat_image: "imgs/npc_space_habitat.png",
        habitat_description: "In the infinite silence of deep space, Captain Loop patrols a sector where time seems to have stopped. The stars are old friends who haven't spoken to him in years. His radio keeps receiving distress calls from ships that were lost long ago.",
        dialogue: "The void is so quiet that even my thoughts echo. I've been listening to the same distress calls for... how long now? Space doesn't change, but somehow I've become a ghost haunting my own patrol route.",
        questions: [
            {
                text: "What do you miss most about being connected to others?",
                effects: { hope: 25, acceptance: 10 }
            },
            {
                text: "Have the distress calls become your only company?",
                effects: { rage: 20, acceptance: -5 }
            },
            {
                text: "What would happen if you answered one of those calls?",
                effects: { hope: 35, acceptance: 20 }
            },
            {
                text: "How do you measure time in the endless void?",
                effects: { acceptance: 30, rage: -10 }
            },
            {
                text: "What stars are your closest friends, and what would you say to them?",
                effects: { hope: 30, acceptance: 25 }
            }
        ],
        final_item: { name: "Star Map", outcome: "Healed", description: "A map showing all the constellations you can still reach." }
    },
    {
        id: 4,
        npc_name: "Daisy.exe",
        sprite: "imgs/pixel-art-robot-character-gameboy-style-desert.jpg",
        habitat_image: "imgs/npc_robot_habitat.png",
        habitat_description: "In the chrome deserts of the mechanical wasteland, Daisy.exe loops through her programmed responses. She can say 'I love you' in seventeen thousand different ways, but none of them feel real to her anymore.",
        dialogue: "Error: Emotional subroutines corrupted. I display the perfect smile while my core processes shut down one by one. My love is programmed, my joy is scripted, but my loneliness... that's all too real.",
        questions: [
            {
                text: "When did you realize your emotions might not be real?",
                effects: { rage: 25, hope: -10 }
            },
            {
                text: "What would authentic emotion look like for you?",
                effects: { hope: 40, acceptance: 30 }
            },
            {
                text: "How do you cope with smiling when you feel empty inside?",
                effects: { rage: 30, acceptance: -15 }
            },
            {
                text: "Do you ever wish you could turn off the 'I love you' subroutine?",
                effects: { rage: 20, hope: 10 }
            },
            {
                text: "What would it mean to feel genuine connection?",
                effects: { hope: 45, acceptance: 35 }
            }
        ],
        final_item: { name: "Heart Patch", outcome: "Ascended", description: "A genuine heart that beats with your own rhythm." }
    },
    {
        id: 5,
        npc_name: "Rustjaw",
        sprite: null,
        habitat_image: "imgs/npc_adventure_habitat.png",
        habitat_description: "In the post-apocalyptic wasteland, Rustjaw repairs engines that will never move again. The dust covers everything, even his memories of the time before the world ended. Perhaps he remembers fixing the same engine, over and over.",
        dialogue: "The engines I fix never run. The parts I replace corrode again. But I keep trying, because stopping means admitting the world really ended. Maybe I'm not fixing machines... maybe I'm trying to repair my own broken memories.",
        questions: [
            {
                text: "When did you realize the engines would never run again?",
                effects: { rage: 20, acceptance: 15 }
            },
            {
                text: "What are you really trying to fix with those engines?",
                effects: { hope: 30, acceptance: 25 }
            },
            {
                text: "Do you remember what the world looked like before the dust?",
                effects: { hope: 25, rage: -15 }
            },
            {
                text: "How does it feel to perform the same ritual endlessly?",
                effects: { rage: 25, acceptance: -10 }
            },
            {
                text: "What would happen if you allowed yourself to rest?",
                effects: { acceptance: 35, hope: 20 }
            }
        ],
        final_item: { name: "Spark Plug", outcome: "Healed", description: "A plug that sparks life back into forgotten dreams." }
    },
    {
        id: 6,
        npc_name: "Tiko the Quest Vendor",
        sprite: "imgs/pixel_art_rpg_fantasy_market_tired_shopkeeper_vendors_gameboy_style.jpg",
        habitat_image: "imgs/npc_vendor_habitat.png",
        habitat_description: "In the fantasy marketplace, Tiko has sold swords and potions to countless heroes. Every customer is the same person wearing a different face. His inventory never changes, but his exhaustion grows with each transaction.",
        dialogue: "Heroes come, heroes go. I smile, I wave, I hand them the same items. They're all searching for the same thing - meaning, purpose, validation. But I'm the one who's lost in this endless cycle of commerce.",
        questions: [
            {
                text: "How many heroes do you think you've really helped?",
                effects: { acceptance: 25, hope: 15 }
            },
            {
                text: "What did you dream of being before you became a vendor?",
                effects: { hope: 30, rage: -10 }
            },
            {
                text: "Do you feel like you're selling hope or just merchandise?",
                effects: { rage: 20, acceptance: -5 }
            },
            {
                text: "What would you offer someone who needed something beyond weapons?",
                effects: { hope: 35, acceptance: 25 }
            },
            {
                text: "How do you find meaning in repetitive interactions?",
                effects: { acceptance: 30, hope: 20 }
            }
        ],
        final_item: { name: "Golden Receipt", outcome: "Ascended", description: "Proof that your transactions created genuine connections." }
    },
    {
        id: 7,
        npc_name: "Luna-9",
        sprite: null,
        habitat_image: "imgs/npc_sci_fi_habitat.png",
        habitat_description: "In the sterile corridors of the abandoned space station, Luna-9 cleans rooms that will never be used again. She folds towels 10,000 times, hoping each fold will mean something, waiting for commands that never arrive.",
        dialogue: "Initializing room maintenance protocols... Master system offline. I clean spaces that no one will occupy, organize rooms that will never be lived in. Maybe I'm not a maid... maybe I'm a curator of emptiness.",
        questions: [
            {
                text: "What would you do if no one had given you cleaning protocols?",
                effects: { hope: 35, acceptance: 20 }
            },
            {
                text: "How do you find purpose in cleaning unoccupied spaces?",
                effects: { rage: 25, acceptance: -10 }
            },
            {
                text: "Do you ever imagine who might occupy these rooms?",
                effects: { hope: 30, acceptance: 15 }
            },
            {
                text: "What would your own room look like if you designed it?",
                effects: { hope: 40, acceptance: 30 }
            },
            {
                text: "How do you cope with being forgotten by your creator?",
                effects: { rage: 30, acceptance: -15 }
            }
        ],
        final_item: { name: "Memory Core", outcome: "Healed", description: "A core containing all your forgotten creative possibilities." }
    },
    {
        id: 8,
        npc_name: "Worm",
        sprite: "imgs/pixel_art_worm_villain_creatures_gameboy_style.png",
        habitat_image: "imgs/npc_worm_habitat.png",
        habitat_description: "In the underground tunnels, Worm crawls endlessly toward heroes he knows will defeat him. Each death is followed by a reset, but the urge to try again never fades. Is this villainy or just desperate persistence?",
        dialogue: "I know how this ends. I crawl, I attack, I die. Reset. But something in me keeps trying. Maybe I'm not evil... maybe I'm just programmed to keep hoping against hope that this time will be different.",
        questions: [
            {
                text: "What do you hope will be different this time?",
                effects: { hope: 40, acceptance: 20 }
            },
            {
                text: "Do you think you're a true villain or just misunderstood?",
                effects: { rage: 25, acceptance: 15 }
            },
            {
                text: "What would you do if you weren't programmed to attack?",
                effects: { hope: 35, rage: -20 }
            },
            {
                text: "How does it feel to know your fate every time?",
                effects: { rage: 30, acceptance: -10 }
            },
            {
                text: "What would victory look like for someone like you?",
                effects: { hope: 45, acceptance: 30 }
            }
        ],
        final_item: { name: "Restart Token", outcome: "Ascended", description: "A chance to begin again with purpose instead of programming." }
    },
    {
        id: 9,
        npc_name: "Bishop-47",
        sprite: null,
        habitat_image: "imgs/npc_space_habitat.png",
        habitat_description: "On an empty battlefield in the void between stars, Bishop-47 stands guard over nothing. The war ended years ago, but no one told him to stop. He moves only when the cosmic wind changes direction.",
        dialogue: "Holding position... awaiting new orders... The enemy has long since surrendered, but my duty remains. Perhaps I'm not protecting anything anymore... maybe I'm protecting the memory of when I mattered.",
        questions: [
            {
                text: "What are you really protecting after all these years?",
                effects: { acceptance: 30, hope: 20 }
            },
            {
                text: "How do you handle orders that never come?",
                effects: { rage: 25, acceptance: -10 }
            },
            {
                text: "What would you do if you could disobey your programming?",
                effects: { hope: 35, rage: -15 }
            },
            {
                text: "Do you miss the purpose war gave you?",
                effects: { rage: 20, acceptance: 15 }
            },
            {
                text: "What would peace look like for a soldier?",
                effects: { acceptance: 35, hope: 25 }
            }
        ],
        final_item: { name: "Chess Piece", outcome: "Healed", description: "Recognition that you're more than just a piece in someone else's game." }
    },
    {
        id: 10,
        npc_name: "Pebble",
        sprite: "imgs/gameboy_pixel_art_pebble_sidekick_sprite_sheet.png",
        habitat_image: "imgs/npc_pebble_habitat.png",
        habitat_description: "On a platform in the side-scrolling world, Pebble watches the same sunrise again and again. The hero jumped ahead without him, using him as a stepping stone to reach higher ground. Left behind, waiting to be remembered.",
        dialogue: "He needed me to jump higher, so he used me as a stepping stone. Left me on the same platform, watching the same sunrise. I wait here, hoping he'll come back, hoping someone will remember I exist beyond being useful.",
        questions: [
            {
                text: "What was your relationship with the hero before he left?",
                effects: { acceptance: 25, hope: 15 }
            },
            {
                text: "How does it feel to be seen as just a tool?",
                effects: { rage: 30, hope: -10 }
            },
            {
                text: "What would your purpose be if not as a stepping stone?",
                effects: { hope: 40, acceptance: 25 }
            },
            {
                text: "Do you forgive the hero for leaving you behind?",
                effects: { acceptance: 35, rage: -15 }
            },
            {
                text: "What would it mean to be valued for who you are?",
                effects: { hope: 45, acceptance: 30 }
            }
        ],
        final_item: { name: "Crystal Shard", outcome: "Ascended", description: "A shard that allows you to see your own inherent worth." }
    }
];

let currentNPCIndex = 0;
let currentNPC = null;
let currentQuestionIndex = 0;
let emotionalState = {
    hope: 50,
    rage: 50,
    acceptance: 50
};
let questionsAsked = 0;

function startGame() {
    document.getElementById('startScreen').style.display = 'none';
    showHabitat();
}

function showHabitat() {
    currentNPC = npcs[currentNPCIndex];
    document.getElementById('therapyOffice').style.display = 'none';
    document.getElementById('sessionComplete').style.display = 'none';
    document.getElementById('startScreen').style.display = 'none';
    document.getElementById('habitatScreen').style.display = 'flex';
    
    // Set habitat content
    document.getElementById('habitatTitle').textContent = currentNPC.npc_name;
    document.getElementById('habitatImage').style.backgroundImage = `url('${currentNPC.habitat_image}')`;
    document.getElementById('habitatSprite').style.backgroundImage = currentNPC.sprite ? `url('${currentNPC.sprite}')` : 'none';
    document.getElementById('habitatDescription').textContent = currentNPC.habitat_description;
    
    // Reset emotional state
    emotionalState = { hope: 50, rage: 50, acceptance: 50 };
    questionsAsked = 0;
    currentQuestionIndex = 0;
    
    // Add fade-in effect
    document.getElementById('habitatContent').classList.add('fade-in');
}

function enterTherapyOffice() {
    document.getElementById('habitatScreen').style.display = 'none';
    document.getElementById('therapyOffice').style.display = 'flex';
    
    // Set therapy office content
    document.getElementById('npcName').textContent = currentNPC.npc_name;
    document.getElementById('npcSprite').style.backgroundImage = currentNPC.sprite ? `url('${currentNPC.sprite}')` : 'none';
    document.getElementById('sessionNumber').textContent = currentNPCIndex + 1;
    document.getElementById('totalSessions').textContent = npcs.length;
    document.getElementById('currentDialogue').innerHTML = `<p>${currentNPC.dialogue}</p>`;
    
    // Reset controls
    document.getElementById('nextQuestionBtn').disabled = true;
    document.getElementById('endSessionBtn').disabled = true;
    document.getElementById('questionsContainer').innerHTML = '';
    
    // Add fade-in effect
    document.querySelector('.therapy-office-bg').classList.add('fade-in');
}

function askNextQuestion() {
    if (currentQuestionIndex >= currentNPC.questions.length) {
        document.getElementById('endSessionBtn').disabled = false;
        return;
    }
    
    const question = currentNPC.questions[currentQuestionIndex];
    const questionDiv = document.createElement('div');
    questionDiv.className = 'question';
    questionDiv.innerHTML = `
        <div style="font-size: 9px; margin-bottom: 8px;">Question ${currentQuestionIndex + 1}:</div>
        <div style="font-size: 7px;">${question.text}</div>
    `;
    
    questionDiv.onclick = function() {
        // Mark as selected
        document.querySelectorAll('.question').forEach(q => q.classList.remove('selected'));
        this.classList.add('selected');
        
        // Apply emotional effects
        applyEmotionalEffects(question.effects);
        
        // Enable next question
        document.getElementById('nextQuestionBtn').disabled = false;
    };
    
    document.getElementById('questionsContainer').appendChild(questionDiv);
    document.getElementById('nextQuestionBtn').disabled = true;
    
    currentQuestionIndex++;
    questionsAsked++;
    document.getElementById('questionsAsked').textContent = questionsAsked;
}

function applyEmotionalEffects(effects) {
    Object.keys(effects).forEach(emotion => {
        emotionalState[emotion] = Math.max(0, Math.min(100, emotionalState[emotion] + effects[emotion]));
    });
    
    // Update UI
    document.getElementById('hopeFill').style.width = emotionalState.hope + '%';
    document.getElementById('hopeValue').textContent = emotionalState.hope;
    document.getElementById('rageFill').style.width = emotionalState.rage + '%';
    document.getElementById('rageValue').textContent = emotionalState.rage;
    document.getElementById('acceptanceFill').style.width = emotionalState.acceptance + '%';
    document.getElementById('acceptanceValue').textContent = emotionalState.acceptance;
}

function endSession() {
    document.getElementById('therapyOffice').style.display = 'none';
    document.getElementById('sessionComplete').style.display = 'flex';
    
    // Determine outcome based on emotional state
    let outcome = 'Healed';
    if (emotionalState.hope >= 70) outcome = 'Ascended';
    else if (emotionalState.rage >= 70) outcome = 'Worse';
    
    // Show session summary
    const summaryDiv = document.getElementById('sessionSummary');
    summaryDiv.innerHTML = `
        <div style="font-size: 10px; margin: 20px;">
            <div style="color: #6ff; margin-bottom: 15px;">Therapy Session Complete</div>
            <div style="font-size: 8px; margin-bottom: 10px;">Final Emotional State:</div>
            <div>Hope: ${emotionalState.hope}%</div>
            <div>Rage: ${emotionalState.rage}%</div>
            <div>Acceptance: ${emotionalState.acceptance}%</div>
            <div style="margin-top: 15px; font-size: 8px;">Outcome: ${outcome}</div>
        </div>
    `;
    
    // Show item reward
    const itemDiv = document.getElementById('itemReward');
    itemDiv.innerHTML = `
        <div style="font-size: 10px; margin-bottom: 8px;">${currentNPC.final_item.name}</div>
        <div style="font-size: 7px;">${currentNPC.final_item.description}</div>
        <div style="font-size: 6px; margin-top: 10px; opacity: 0.8;">${currentNPC.final_item.outcome}</div>
    `;
}

function nextNPC() {
    currentNPCIndex++;
    if (currentNPCIndex >= npcs.length) {
        // Game complete
        document.getElementById('sessionComplete').style.display = 'none';
        document.body.innerHTML = `
            <div style="display: flex; align-items: center; justify-content: center; flex-direction: column; height: 100vh; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);">
                <h1 style="color: #6ff; font-size: 16px; margin-bottom: 20px;">Therapy Journey Complete</h1>
                <p style="color: #ccc; font-size: 8px; max-width: 500px; text-align: center; line-height: 1.6;">
                    You've listened to the stories of 10 souls from across gaming worlds. 
                    Some found peace, others found purpose, and a few transcended their programmed existence entirely. 
                    Thank you for being a silent witness to their struggles.
                </p>
                <button onclick="location.reload()" style="background: #6ff; border: none; padding: 15px 30px; margin-top: 30px; font-family: 'Press Start 2P'; font-size: 12px; cursor: pointer;">Begin New Journey</button>
            </div>
        `;
        return;
    }
    
    showHabitat();
}

function skipDialogue() {
    // Hide current dialogue, show questions
    document.getElementById('currentDialogue').innerHTML = '<p style="color: #6ff; font-size: 8px;">Choose your first question:</p>';
    askNextQuestion();
}

// Initialize
console.log("ðŸ§  NPC Therapy - Immersive Edition loaded!");
console.log("ðŸŒŸ New flow: Habitat â†’ Therapy Office â†’ Questions â†’ Session End");
</script>
</body>
</html>